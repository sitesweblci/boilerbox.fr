{# src/Lci/BoilerBoxBundle/Resources/views/Registration/newSite.html.twig #}
{% extends "LciBoilerBoxBundle::secondLayoutLogged.html.twig" %}

{% block boilerBoxCSS %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/lciboilerbox/css/vertical-form-template.css') }}" />
{% endblock boilerBoxCSS %}

{% block mainBody %}
    <main id="monCompte" data-is-admin="{{ is_granted('ROLE_ADMIN') }}">
        <header class="sub-header sub-header--grey">
            <p class="sub-header__chip"><span>n</span></p>
            <h1 class="sub-header__title">Nouvel utilisateur</h1>
        </header>

		{{ form_start(form, {'attr': {'class':'formMonCompte form'}}) }}
        <div id="contenuMonCompte" class="tab-wrapper">
            <ul class="tab-wrapper__tabs">
                <li class="tab-wrapper__tabs__tab active" data-tab-target="#monCompteProfil">Profil</li>
                <li class="tab-wrapper__tabs__tab" data-tab-target="#monCompteAuthentification">Authentification</li>
				<li class="tab-wrapper__tabs__tab" data-tab-target="#monCompteAutre">Autre</li>
            </ul>

            <div class="tab-wrapper__content">
                <div id="monCompteProfil" class="active" data-tab-content>
                    <div class="formMaxHeightMonCompte">
                        <div class="form__field">
                            <h3 class="form__field__title">Informations</h3>
                            <div class='champsAdmin'>
                                {{ form_label(form.enabled) }}
                                {{ form_widget(form.enabled) }}
                                <div class="ligne_error">{{ form_errors(form.enabled) }}</div>
                            </div>

    						<div class='champsAdmin'>
                               	{{ form_label(form.username) }}
                               	{{ form_widget(form.username) }}
                               	<div class="ligne_error">{{ form_errors(form.username) }}</div>
    						</div>

    						<div class='champsAdmin'>
                               	{{ form_label(form.label) }}
                               	{{ form_widget(form.label) }}
                               	<div class="ligne_error">{{ form_errors(form.label) }}</div>
    						</div>

    						<div>
                               	{{ form_label(form.nom) }}
    							{{ form_widget(form.nom) }}
                               	<div class="ligne_error">{{ form_errors(form.nom) }}</div>
    						</div>

    						<div>
                               	{{ form_label(form.prenom) }}
    							{{ form_widget(form.prenom) }}
                               	<div class="ligne_error">{{ form_errors(form.prenom) }}</div>
    						</div>

    						<div>
                               	{{ form_label(form.email) }}
    							{{ form_widget(form.email) }}
    							<div class="ligne_error">{{ form_errors(form.email) }}</div>
    						</div>

                            <div class='champsAdmin'>
                                {{ form_label(form.roles) }}
                                <div>{{ form_widget(form.roles) }}</div>
                                <div class="ligne_error">{{ form_errors(form.roles) }}</div>
                            </div>
                        </div>
                        <div class="form__field">
                            <h3 class="form__field__title">Préférences</h3>
                            <label for="">Couleur</label>
                            <div id="containerCouleurUser">
                                <div id="rondCouleurUserOrange" class="rondCouleurUser rondCouleurUserActif" onClick="definirCouleur('persoInactif')"></div>
                                <div id="rondCouleurUserJaune" class="rondCouleurUser" onClick="definirCouleur('persoJaune')"></div>
                                <div id="rondCouleurUserBleu" class="rondCouleurUser" onClick="definirCouleur('persoBleu')"></div>
                                <div id="rondCouleurUserVert" class="rondCouleurUser" onClick="definirCouleur('persoVert')"></div>
                                <div id="rondCouleurUserRouge" class="rondCouleurUser" onClick="definirCouleur('persoRouge')"></div>
                                <div id="rondCouleurUserAzur" class="rondCouleurUser" onClick="definirCouleur('persoAzur')"></div>
                                <div id="rondCouleurUserViolet" class="rondCouleurUser" onClick="definirCouleur('persoViolet')"></div>
                                <div id="rondCouleurUserMagenta" class="rondCouleurUser" onClick="definirCouleur('persoMagenta')"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="monCompteAuthentification" data-tab-content>
                    <div id="site_siteConnexion_accesDistant" class="formMaxHeightMonCompte">
                        <div class="form__field">
                            <h3 class="form__field__title">Définition du mot de passe</h3>
    						<div>
    							{{ form_label(form.plainPassword.first, 'Mot de passe') }}
    							{{ form_widget(form.plainPassword.first) }}
    							<div class="ligne_error">{{ form_errors(form.plainPassword.first) }}</div>
    						</div>
    						<div>
                                {{ form_label(form.plainPassword.second, 'Vérification du mot de passe') }}
                                {{ form_widget(form.plainPassword.second) }}
    							<div class="ligne_error">{{ form_errors(form.plainPassword.second) }}</div>
                            </div>
							<div>
								<button class='generate'>Générer</button>
							</div>
                        </div>
                    </div>
                </div>

                <div id="monCompteAutre" data-tab-content>
                    <div class="formMaxHeightMonCompte">
                        <div class="form__field">
                            <h3 class="form__field__title">Informations</h3>
                    		<div class='champsAdmin'>
                        		{{ form_label(form.informations) }}
                        		{{ form_widget(form.informations) }}
                        		<div class="ligne_error">{{ form_errors(form.informations) }}</div>
                    		</div>
                        </div>
                        <div class="form__field">
                            <h3 class="form__field__title">Mode de partage privé</h3>
                            <div>
                                {{ form_label(form.modePrive) }}
                                {{ form_widget(form.modePrive) }}
                                <div class="ligne_error">{{ form_errors(form.modePrive) }}</div>
                            </div>
                        </div>
                        <div class="form__field">
                            <h3 class="form__field__title">Langue</h3>
                            <div>
                                {{ form_label(form.langue) }}
                                {{ form_widget(form.langue) }}
                                <div class="ligne_error">{{ form_errors(form.langue)}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form__btn form__btn--col">
                <div class="btn btn--main {{ app.user.couleur }}" onClick="attente(); document.forms['fos_user_registration_form'].submit();">Enregistrer</div>
                <div class="btn btn--second" onClick="attente(); redirection('accueilConfUtilisateur');">Annuler</div>
            </div>
        </div>
		{{ form_end(form) }}
        
    </main>
{% endblock mainBody %}



{% block javascript %}
<script type='text/javascript'>
	// Gestion du mot de passe aléatoire 
	$(document).ready(function() {
    	/* évènement click sur un element de class "generate" > appelle la fonction generate() */
    	$(document).on('click','.generate', function(e){
    	    /* ajout du mot de passe + changement du paramètre type de password vers text (pour lisibilité)  : Indiquer un chiffre pour modifier le nombre de caractère du mot de passe : Par défaut = 8 */
			$mot_de_passe_aléatoire = generate();
			console.log(generate() + '  - ' + $mot_de_passe_aléatoire);
    	    $("form input[type='password']").val($mot_de_passe_aléatoire);
    	});
	});
    // Fonction style barre de navigation page active
    $(window).on('load', function pageActive(){
        $('.side-nav .parametres').addClass('active');
    });

	var is_admin = $('#monCompte').data("is-admin");
	if (is_admin) {
		$('.champsAdmin').removeClass('cacher');
	}

	$('#switchAuthentificationDoubleFacteur').click(function() {
		document.location.href = $('#switchAuthentificationDoubleFacteur').data('href');
	});

    var $index = 0;

    const tabs = document.querySelectorAll('[data-tab-target]')
    const tabContents = document.querySelectorAll('[data-tab-content]')

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = document.querySelector(tab.dataset.tabTarget)
            tabContents.forEach(tabContent => {
                tabContent.classList.remove('active')
            })
            tabs.forEach(tab => {
                tab.classList.remove('active')
            })
            tab.classList.add('active')
            target.classList.add('active')
        })
    });

	function definirCouleur(couleur) {
		$('#fos_user_registration_form_couleur').val(couleur);	
	}



	function generate(l) 
	{
		// Mot de passe de 8 caractères
	    if (typeof l==='undefined'){var l=8;}
	    /* c : chaîne de caractères alphanumérique */
	    var c='abcdefghijknopqrstuvwxyzACDEFGHJKLMNPQRSTUVWXYZ12345679',
	    n=c.length,
	    /* p : chaîne de caractères spéciaux */
	    p='!@#$+-*&_',
	    o=p.length,
	    r='',
	    /* s : determine la position du caractère spécial dans le mdp */
	    s=Math.floor(Math.random() * (p.length-1));
	
	    for(var i=0; i<l; ++i){
	        if(s == i){
	            /* on insère à la position donnée un caractère spécial aléatoire */
	            r += p.charAt(Math.floor(Math.random() * o));
	        }else{
	            /* on insère un caractère alphanumérique aléatoire */
	            r += c.charAt(Math.floor(Math.random() * n));
	        }
	    }
	    return r;
	}
</script>
{% endblock javascript %}




