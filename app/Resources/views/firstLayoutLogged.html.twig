<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="L'Interface de supervision des Chaudières Industrielles">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    {% block boilerBoxCSS %}
        <link rel="icon" type="image/png" href="{{ asset('bundles/lciboilerbox/images/img/favicon.png') }}" />

        <link rel="stylesheet" href="{{ asset('bundles/lciboilerbox/css/style.css') }}" />
        <link rel="stylesheet" href="{{ asset('bundles/lciboilerbox/css/bbCloud.css') }}" />
    {% endblock boilerBoxCSS %}
	<link rel="stylesheet" type="text/css"  href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css"/>

	<title> {% block title %}Boiler-Box Cloud{% endblock title %}</title>
</head>

<body style='padding-left:65px'>
	<header class="header">
        <nav>
            <div class="burger" onclick="showMenuLateral()">
                <span></span>
            </div>
            <a class="watermark" href="{{ path("lci_boilerbox_index") }}">
                <img class="watermark__logo" src="{{ asset('bundles/lciboilerbox/images/img/logoIBC.svg') }}" alt="Logo IBC">
                <p class="watermark__baseline">
                    <span>INDUSTRIAL</span>
                    <span>BOILER</span>
                    <span>CONTROL</span>
                </p>
            </a>
        </nav>

        <nav>
			{% if is_granted('ROLE_ADMIN') %}
            	<a class="header__nav tooltip-wrapper" href='{{ path("lci_gestion_admin") }}'> 
            	    <img src="{{ asset('bundles/lciboilerbox/images/img/nav/parametre.svg') }}" alt="icône Paramètre" class="header__nav__img">
            	    <span class="tooltip">Paramètres</span>
            	</a>
			{% endif %}
            {# <a class="header__nav tooltip-wrapper" href="https://www.google.com/maps/d/u/0/embed?mid=1HvyRmqnv2__T4xk8EDwLBcZoulMvx7C1" >
                <img src="{{ asset('bundles/lciboilerbox/images/img/nav/localisation.svg') }}" alt="icône localisation des sites" class="header__nav__img">
                <span class="tooltip">Localisation</span>
            </a> #}
			<span {# id="btnIdentified"  #}class="header__nav header__nav--account {{ app.user.couleur }}">
                <span>{{ app.user.label | slice(0,1) }}</span>
            </span>
        </nav>
    </header>

    <div class="logged cacher">
        <div></div>
        <div class="logged__infos">
            <span class="logged__infos__chip {{ app.user.couleur }}">
                <span class="">{{ app.user.label | slice(0,1) | lower }}</span>
            </span>
            <div class="logged__infos__name">
                <p>{{ app.user.username }}</p>
                <p>{{ app.user.email }}</p>
            </div>
        </div>
	    <div class="logged__mode">
	        <div id="choixPrivePublicPopUpId" class="row-wrap">
	            <label class="switch switch--small" data-href="">
	                <input type="checkbox" id="modePrivePublic" onClick="$Refresh_page=true; switchModePrivateTo();" {% if app.user.modePrive %}checked{% endif %}>
	                <span></span>
	            </label>
				{% if app.user.modePrive == false %}
	               	<p>Mode Public</p>
				{% else %}
					<p>Mode Privé</p>
				{% endif %}
	        </div>
	    </div>
        <ul class="logged__links">
            <li><a href="{{ path('lci_update_user_own', {'idUtilisateur': app.user.id }) }}">mon compte</a></li>
            <li><a href="{{ path('fos_user_security_logout') }}">se déconnecter</a></li>
        </ul>
    </div>

    <nav class="side-nav">
        <div class="side-nav__content scroll">
            <ul>
                <li><a href="{{ path("lci_boilerbox_index")}}">
                    <i class="index"></i><span>Accueil</span>
                </a></li>
                <li><a href="{{ path('lci_update_user_own', {'idUtilisateur': app.user.id }) }}">
                    <i class="account"></i><span>Mon compte</span>
                </a></li>
                <button>
                    <i class="parc-tech"></i><span>Gestion parc technique</span>
                </button>
                <ul class="side-nav__sub-list">
                    <li><a href="{{ path('lci_register_module', {'provenance':'accueil' }) }}">
                        <i class="add-module"></i><span>Ajouter module</span>
                    </a></li>
                    <li><a href="{{ path('lci_register_problemeTechnique') }}">
                        <i class="prob-tech"></i><span>Signaler problème tecnique</span>
                    </a></li>
                    <li><a href="{{ path('lci_gestion_modules') }}">
                        <i class="parc-module"></i><span>Parc modules</span>
                    </a></li>
                    {% if is_granted('ROLE_RESPONSABLE_PARC') %}
                        <li><a href="{{ path('lci_register_equipement', {'provenance':'accueil'}) }}">
                            <i class="add-equip"></i><span>Ajouter équipement</span>
                        </a></li>
                        <li><a href="{{ path('lci_affiche_problemes') }}">
                            <i class="list-prob"></i><span>Liste problèmes techniques</span>
                        </a></li>
                        <li><a href="{{ path('lci_gestion_equipements') }}">
                            <i class="parc-equip"></i><span>Parc équipements</span>
                        </a></li>
                    {% endif %}
                </ul>
                <button>
                    <i class="bons-interv"></i><span>Bons d'interventions</span>
                </button>
                <ul class="side-nav__sub-list">
                    {% if is_granted('ROLE_SAISIE_BA') %}
                        <li><a href="{{ path('lci_bons_saisie') }}"> 
                            <i class="saisie"></i><span>Saisie</span>
                        </a></li>
                    {% endif %}
                    <li><a href="{{ path('lci_bons_visualiser') }}">
                        <i class="visu"></i><span>Visualiser</span>
                    </a></li>
                    <li><a href="{{ path('lci_bons_sitesBA_visualiser') }}">
                        <i class="visu-site"></i><span>Visu des sites</span>
                    </a></li>
                </ul>
                {% if is_granted('ROLE_ADMIN') %}
                    <li><a href="{{ path('lci_cgu_show') }}">
                        <i class="cgu"></i><span>CGU</span>
                    </a></li>
                {% endif %}
                {% if is_granted('ROLE_TECHNICIEN') %}
                    <li><a href="{{ path("lci_generation_mdp")}}">
                        <i class="gene-mdp"></i><span>Générateur mot de passe</span>
                    </a></li>
                {% endif %}
                <button>
                    <i class="parametres"></i><span>Paramètres</span>
                </button>
                <ul class="side-nav__sub-list">
                    <li><a href="{{ path('lci_accueil_register_user') }}">
                        <i class="gestion-user"></i><span>Gestion utilisateurs</span>
                    </a></li> 
                    <li><a href="{{ path('lci_accueil_register_site') }}">
                        <i class="gestion-site"></i><span>Gestion sites</span>
                    </a></li>
                    <li><a href="{{ path('lci_registration_link') }}">
                        <i class="gestion-lien"></i><span>Gestion liens</span>
                    </a></li>
                    {% if is_granted('ROLE_SUPER_ADMIN') %}
                        <button>
                            <i class="utilitaires"></i><span>Utilitaires</span>
                        </button>
                        <ul class="side-nav__sub-list">
                            <li><a href="{{ path('lci_utils_afficheDispoSites') }}">
                                <i class="dispo-site"></i><span>Disponibilités sites</span>
                            </a></li>
                            <li><a href="{{ path('lci_register_role') }}">
                                <i class="gestion-role"></i><span>Gestion rôles</span>
                            </a></li>
                            <li><a href="{{ path('lci_affiche_logs_connexion') }}">
                                <i class="logs"></i><span>Logs connexion</span>
                            </a></li>
                        </ul>
                    {% endif %}
                </ul>
                <li><a href="{ path('fos_user_security_logout') }}">
                    <i class="disconnect"></i><span>Se déconnecter</span>
                </a></li>
            </ul>
        </div>
        <div class="side-nav__footer">
            <a target="_blank" href="{{ path('lci_cgu_courantes') }}">
                C<span class="w54">onditions </span>G<span>énérales d'</span>U<span>tilisation</span>
            </a>
        </div>
    </nav>


    <div id='popUpError' class='message-box cacher'>
		{% set popup_error = false %}
        <div class="close-cross close-cross--light" onClick="clotureMessageErreur();"></div>
        {% if app.session.flashbag.peek('erreur') | length  > 0 %}
			{% set popup_error = true %}
			<h1 class="message-box__title message-box__title--error">Erreur rencontrée</h1>
            <div class="message-box__content">
                <img src="{{ asset('bundles/lciboilerbox/images/img/warningError.svg') }}" alt="icône Erreur">
                <p>
                    {% for message in app.session.flashbag.get('erreur') %}
                        {{ message|raw }}<br /><br />
                    {% endfor %}
                </p>
            </div>
        {% endif %}
        {% if  app.session.flashbag.peek('info') | length  > 0 %}
			{% set popup_error = true %}
            <h1 class="message-box__title">Informations</h1>
            <div class="message-box__content">
                <img src="{{ asset('bundles/lciboilerbox/images/img/warningInfo.svg') }}" alt="icône Info">
                <p>
                    {% for message in app.session.flashbag.get('info') %}
                        {{ message|raw }}<br /><br />
                    {% endfor %}
                </p>
            </div>
        {% endif %}
        <p class="btn btn--main btn--wide" onClick="clotureMessageErreur();">compris</p>
    </div>

    <div id="cartonBlack" class='cacher'></div>
    <div id="fonduBlack" class='cacher'></div>

    {% block liens_url %}
        <input type='hidden' name='variables_globales_twig' id='variables_globales_twig' data-prefixImage="{{ prefix_image }}">
    {% endblock liens_url %}

{% block mainBody %}
{% endblock mainBody%}

    <script src="{{ asset('bundles/lciboilerbox/js/jquery.js') }}"></script>
	<script type="text/javascript" src="{{ asset('bundles/lciboilerbox/js/jquery-ui-1.12.1.min.js') }}"></script>
	<script type="text/javascript" src="{{ asset('js/jquery.ui.datepicker-fr.js') }}"></script>	

	<script src="{{ asset('bundles/fosjsrouting/js/router.min.js') }}"></script>
	<script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
	<script src="{{ asset('bundles/lciboilerbox/js/fonctions_generales.js') }}"></script>


    <script type="text/javascript">
		// Variable indiquant le mode publique /ou privé actif */
    	var $Mode_prive = "{{ app.user.modePrive }}";
		// Variable indiquant si on dispose des droits administrateurs 
		var $admin_granted = "{{ is_granted('ROLE_ADMIN') }}";
		var $tech_granted = "{{ is_granted('ROLE_TECHNICIEN') }}";
		// Variable indiquant si la page doit être rafraichie ou non dans certaines fonctions
		var $Refresh_page = true;

        // Fonction side nav
        $(".side-nav li").on("click", function pageActive(){
            $(".side-nav li").removeClass("active");
            $(this).addClass("active");
        });
        $(".side-nav button").on("click", function displaySubNav(){
            $(this).next(".side-nav__sub-list").toggleClass("displayed");
        });
        // Fonction pour afficher le menu latéral
        function showMenuLateral(){
            // let widthSideNav = $('.side-nav').width() +'px';
            // $('.side-nav').removeClass('side-nav--first-load no-transition');
            // $('.side-nav').css('margin-left','-' + widthSideNav);
            // $('.side-nav').toggleClass('side-nav--visible');
            // $('#cartonBlack').toggleClass('cacher');
            // $('html').toggleClass('no-scroll');
            // if (!($('#cartonBlack').hasClass('cacher'))){
            //     $('#cartonBlack').on('click',function(){
            //         $('.side-nav').removeClass('side-nav--visible');
            //         $('#cartonBlack').addClass('cacher');
            //         $('html').removeClass('no-scroll');
            //     });
            // };
            // $(window).resize(function() {
            //     let widthSideNav = $('.side-nav').width() +'px';
            //     $('.side-nav').css('margin-left','-' + widthSideNav);
            // });
            $('.side-nav').toggleClass('side-nav--visible');
        };

        // Fonction pour afficher la petite popup "mon compte" au survol du bouton mon compte
        $('.header__nav--account').bind('click mouseenter', function(){
            $('.logged').toggleClass('cacher');
        });
        $('.logged').on('mouseleave', function(){
            $('.logged').addClass('cacher');
        });
    	$(document).ready(function() {
    	    if("{{popup_error}}") {
    	        $('#popUpError').removeClass('cacher')
    	        $('#cartonBlack').removeClass('cacher')
    	    }
    	});

    	function clotureMessageErreur() {
    	    $('#popUpError').addClass('cacher');
    	    $('#cartonBlack').addClass('cacher');
    	}


		// Fonction qui switch entre mode privé et mode publique 
		// Un argument est passé indiquant si la page doit être raffrachie
		function switchModePrivateTo() {
    		$.ajax({
    		    url: "{{ path('lci_switch_user_mode') }}",
    		    type: 'POST',
				success: function ($data, textStatus, jqXHR) {
					// Si la variable globale $Refresh_page est true on rafraichi la page
					if ($Refresh_page == true) {
						window.location.assign(window.location.href);
            		} 
				},
    		    error: function (jqXHR, textStatus, errorThrown) {
    		        console.log('error ' + textStatus + ' - -' + errorThrown );
    		        alert('Echec de changement de mode');
    		    }
    		});
    		// On inverse la variable de mode
			reverse_variable('mode_prive');
			// 
			switch($Mode_prive) 
			{
				case true:
					$('#choixPrivePublicPopUpId p').text('Mode privé');
					break;
				case false:
					$('#choixPrivePublicPopUpId p').text('Mode publique');
					break;
			}
			return 0;
		}

		// Fonction qui retourne l'inverse de la variable (booleenne) passée en argument
		function reverse_variable($variable) 
		{
			switch($variable) 
			{
				case 'mode_prive':
					$Mode_prive = !($Mode_prive);
					break;
			}
		}
    </script>
    
    {% block javascript %}
    {% endblock javascript %}


</body>
</html>
